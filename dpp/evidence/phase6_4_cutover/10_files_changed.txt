Phase 6.4 — Files Changed
==========================
Date    : 2026-02-21
Branch  : phase6-preflight

NEW FILES
---------
dpp/tools/pilot_cutover_run.sh
  - set -euo pipefail
  - Step 1: RC Gates (rc_double_then_ci_then_archive.sh → fallbacks)
  - Step 2: Staging dry-run + P4.3 data isolation
  - Step 3: App rollback drill (rollback_drill.sh → kubectl fallback)
  - Step 3b: DB checkpoint gate — creates template, exit 2 if not COMPLETED
  - Steps 4-5: Calls seal_evidence_to_worm.sh
  - --seal-only mode: resumes sealing from EVIDENCE_DIR (after human step)
  - AWS_PROFILE defaulted to dpp-admin (MANDATORY per DPP ops rules)
  - No env dump (AC5 security compliance)

dpp/tools/seal_evidence_to_worm.sh
  - set -euo pipefail
  - tar -czf evidence.tar.gz (excludes itself + sha256 file)
  - sha256sum / shasum -a 256 (cross-platform: GNU + macOS)
  - RETAIN_UNTIL computed as now + DPP_WORM_RETENTION_DAYS days (GNU + BSD date)
  - aws s3api put-object with --object-lock-mode + --object-lock-retain-until-date
  - aws s3api head-object verification (VersionId + ObjectLockMode)
  - 60_evidence_seal_manifest.json (python3 JSON generation)
  - s3_bucket redacted in manifest (AC5)
  - AWS_PROFILE defaulted to dpp-admin

dpp/ops/runbooks/pilot_cutover_run.md
  - One-shot execution order with pre-conditions checklist
  - Required ENV table (no real values)
  - Run 1 and Run 2 (--seal-only) instructions
  - Evidence directory structure
  - Failure scenarios for each step
  - Sign-off table

dpp/ops/runbooks/db_rollback_verification_human.md
  - HUMAN ONLY header (explicit, top of doc)
  - Section A: Supabase (Restore to New Project + PITR)
  - Section B: AWS RDS (snapshot restore + PITR via awscli)
  - Section C: Common checklist + cleanup instructions
  - Section D: Sign-off template for 55_db_rollback_human_checkpoint.txt
  - Security constraints (never overwrite prod, delete restored DB within 2h)

dpp/apps/api/tests/test_phase6_4_seal_manifest_static.py
  - T1: Valid manifest passes all required field checks (sha256/retain_until/lock_mode format)
  - T2: Each missing required field detected (parametrized × 5 fields)
  - T3: Evidence dir timestamp pattern validated (YYYYMMDDTHHMMSSz)
  - T4: S3 key construction rule validated (prefix/phase6_4_cutover/TS/evidence.tar.gz)
  - T5: seal_evidence_to_worm.sh exists with safety keywords
  - T6: pilot_cutover_run.sh exists with set -euo pipefail + exit 2 + no env dump

dpp/evidence/phase6_4_cutover/ (static evidence templates — this folder)
  00_scope.txt                        Phase 6.4 scope
  10_files_changed.txt                This file
  20_diffstat.txt                     Line count summary
  55_db_rollback_human_checkpoint.txt Template for human sign-off
  90_result_summary.txt               AC checklist

Runtime evidence (gitignored, generated by pilot_cutover_run.sh):
  dpp/evidence/phase6_4_cutover/<TS>/
    00_scope.txt, 30_rc_gates.txt, 40_staging_dry_run.txt,
    50_rollback_drill.txt, 55_db_rollback_human_checkpoint.txt,
    60_evidence_seal_manifest.json, 70_worm_upload_stdout.txt,
    90_result_summary.txt, evidence.tar.gz, evidence.tar.gz.sha256
